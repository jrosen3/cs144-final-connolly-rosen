<!-- http://static.echonest.com/demo/genre/genre.html?genre=anti-folk -->

<!DOCTYPE html>
<html>
  <head>
    <title>The Genre Radio Demo</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
  </head>

<body>
    <div id='content'>
        <h1 id='title'> The Echo Nest Genre Radio Demo </h1>
        <h2 class ='info'> CS144r Final Project </h2>

        <div id='seed'>
            <button value="go" id="go" name="go"  onclick="newGenre('rap')"> Go </button>
        </div>

        <div id="info"> </div>

        <div id="all_results">
            <div id='tracks'>
                <div id="results"> </div>
            </div>
        </div>

        <div id='footer'> 
            Powered by <a href="http://the.echonest.com">The Echo Nest</a> and <a href="http://spotify.com">Spotify</a>. 
        </div>
    </div>
</body>

<script type="text/javascript">
    jQuery.ajaxSettings.traditiCGC445MPLTB9GWTEWonal = true; 
    var apiKey = '';
    var host = 'http://developer.echonest.com/';

    var embed = '<iframe src="https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:TRACKS" style="width:640px; height:540px;" frameborder="0" allowtransparency="true"></iframe>';


    function fetchGenrePlaylist(genre,  wandering, variety) {
        var url = host + 'api/v4/playlist/static?api_key='  + apiKey;

        $("#all_results").hide();
        info("Creating the playlist ...");

        $.getJSON(url, { 'genre': genre, 'format':'json', 
                'bucket': [ 'id:spotify-WW', 'tracks'], 'limit' : true,
                'variety' : variety, 
                'dmca' : true,
                'results': 12, 'type':'genre-radio',  }, 

                function(data) {
                    info("");
                    $("#results").empty();
                    if (! ('songs' in data.response)) {
                        info("Can't find that genre");
                    } else {
                        history.replaceState({}, document.title, '?genre=' + genre);
                        info(genre + ' playlist');
                        $("#all_results").show();
                        var tracks = "";
                        for (var i = 0; i < data.response.songs.length; i++) {
                            var song = data.response.songs[i];
                            var tid = song.tracks[0].foreign_id.replace('spotify-WW:track:', '');
                            tracks = tracks + tid + ',';
                        }
                        var tembed = embed.replace('TRACKS', tracks);
                        tembed = tembed.replace('PREFEREDTITLE', genre + ' playlist');
                        var li = $("<span>").html(tembed);
                        $("#results").append(li);
                    }
                }).error( 
                    function() { 
                        info("Sorry, trouble making a playlist for the genre " + genre);
                } );
    }

    function newGenre(genre) {
        if (genre.length > 0) {
            fetchGenrePlaylist(genre, false, .2);
        } else {
            info("You must pick a genre");
        }
    }

    function info(txt) {
        $("#info").text(txt);
    }

</script>
</html>